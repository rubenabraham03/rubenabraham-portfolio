<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Blackjack</title>
<link rel="stylesheet" href="../styles.css">
<style>
  /* Base layout kept minimal to fit 260px iframed height */
  html, body { height: 100%; overflow: hidden; }
  .wrap { max-width: 760px; margin: 0 auto; padding: 8px 10px; }
  .hdr { display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; }
  .hdr h1 { margin:0; font-size: 1rem; }
  .table { padding: 8px; border: 1px solid var(--card-border); border-radius: 12px; background: var(--card); }
  .row { display:flex; gap:8px; align-items:flex-start; }
  .col { flex:1; min-width: 0; }
  .col h3 { margin:0 0 4px; font-size:.95rem; }
  .cards { display:flex; gap:6px; flex-wrap:wrap; }
  .cardv { padding:6px 8px; border-radius:8px; border:1px solid var(--card-border); background:#fff; color:#111; min-width:28px; text-align:center; font-size:.9rem; line-height:1.1; }
  .controls { display:flex; gap:6px; margin-top:8px; flex-wrap:wrap; }
  .btn { cursor:pointer; border:1px solid var(--card-border); border-radius:8px; padding:6px 10px; background:var(--card); color:var(--text); font-size:.9rem; }
  .btn.primary { background: linear-gradient(135deg, var(--primary), var(--primary-2)); color:#0b0d12; border:0; }
  .status { margin-left:auto; color: var(--muted); font-size:.9rem; white-space:nowrap; }
  /* Compact mode: smaller fonts, tighter spacing */
  .compact .cardv { padding:5px 6px; font-size:.85rem; min-width:26px; }
  .compact .btn { padding:5px 8px; font-size:.85rem; }
  .compact .col h3 { font-size:.9rem; }
</style>
</head>
<body>
  <main class="wrap">
    <div class="hdr">
      <h1>Blackjack</h1>
      <div id="status" class="status">Press Deal</div>
    </div>

    <div class="table">
      <div class="row">
        <div class="col">
          <h3>Dealer <span id="dealerTotal"></span></h3>
          <div id="dealer" class="cards"></div>
        </div>
        <div class="col">
          <h3>Player <span id="playerTotal"></span></h3>
          <div id="player" class="cards"></div>
        </div>
      </div>

      <div class="controls">
        <button id="deal" class="btn primary">Deal</button>
        <button id="hit" class="btn">Hit</button>
        <button id="stand" class="btn">Stand</button>
        <button id="reset" class="btn">Reset</button>
      </div>
    </div>
  </main>

<script>
  // Compact mode class
  (function(){
    const p = new URLSearchParams(location.search);
    if (p.get('compact') === '1') document.body.classList.add('compact');
  })();

  let deck = [], dealer = [], player = [], isOver = false;
  const suits = ["♠","♥","♦","♣"];
  const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];

  function buildDeck() {
    deck = [];
    for (const s of suits) for (const r of ranks) deck.push({r,s});
    for (let i = deck.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [deck[i], deck[j]] = [deck[j], deck[i]];
    }
  }
  function cardValue(c) { if (c.r === "A") return 11; if (["K","Q","J"].includes(c.r)) return 10; return parseInt(c.r,10); }
  function handValue(hand) {
    let t = 0, a = 0;
    for (const c of hand) { t += cardValue(c); if (c.r === "A") a++; }
    while (t > 21 && a > 0) { t -= 10; a--; }
    return t;
  }
  function dealCard(to){ to.push(deck.pop()); }
  function setStatus(msg){ document.getElementById('status').textContent = msg; }

  function draw(){
    const d = document.getElementById('dealer');
    const p = document.getElementById('player');
    const dt = document.getElementById('dealerTotal');
    const pt = document.getElementById('playerTotal');
    d.innerHTML = dealer.map(c => `<div class="cardv">${c.r}${c.s}</div>`).join("");
    p.innerHTML = player.map(c => `<div class="cardv">${c.r}${c.s}</div>`).join("");
    dt.textContent = `(${handValue(dealer)})`;
    pt.textContent = `(${handValue(player)})`;
  }

  function start(){
    isOver = false; dealer = []; player = [];
    buildDeck(); dealCard(player); dealCard(dealer); dealCard(player); dealCard(dealer);
    draw(); setStatus("Your move");
    if (handValue(player) === 21) { setStatus("Blackjack. You win"); isOver = true; }
  }
  function dealerPlay(){ while (handValue(dealer) < 17) dealCard(dealer); draw(); }

  document.getElementById('deal').onclick = start;
  document.getElementById('hit').onclick = () => {
    if (isOver || player.length === 0) return;
    dealCard(player); draw();
    if (handValue(player) > 21) { setStatus("Bust. Dealer wins"); isOver = true; }
  };
  document.getElementById('stand').onclick = () => {
    if (isOver || player.length === 0) return;
    dealerPlay();
    const pv = handValue(player), dv = handValue(dealer);
    if (dv > 21) setStatus("Dealer busts. You win");
    else if (pv > dv) setStatus("You win");
    else if (pv < dv) setStatus("Dealer wins");
    else setStatus("Push");
    isOver = true;
  };
  document.getElementById('reset').onclick = () => {
    dealer = []; player = []; deck = []; isOver = false; draw(); setStatus("Press Deal");
  };
</script>
</body>
</html>
